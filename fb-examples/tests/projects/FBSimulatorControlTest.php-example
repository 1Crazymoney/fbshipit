<?hh
/**
 * Copyright (c) 2016-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 */
namespace Facebook\ShipIt;


final class FBSimulatorControlTest extends FBProjectBaseTest {

  protected static function map(
    ShipItChangeset $changeset,
  ): ShipItChangeset {
    return ShipItFBSimulatorControl::filterChangeset(
      $changeset,
    );
  }

  protected function getExamplePublicPath(): string {
    return 'fbobjc/EndToEndTests/FBSimulatorControl/src/foo';
  }

  public function testPathMappings(): void {
    $root = 'fbobjc/EndToEndTests/FBSimulatorControl/src';
    $diffs = ImmMap {
      $root.'/magicDir/File.foo' => 'magicDir/File.foo',
      $root.'/file.foo' => 'file.foo',
    };
    $in = (new ShipItChangeset())
      ->withDiffs(self::diffsFromMap($diffs));
    $out = self::map($in);
    foreach ($diffs as $_ => $expected_output_file) {
      $this->assertSame(
        $expected_output_file,
        $out
          ->getDiffs()
          ->filter($diff ==> $diff['path'] === $expected_output_file)
          ->map($diff ==> $diff['body'])
          ->firstValue(),
      );
    }
  }
}
